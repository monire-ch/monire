---
import { getLocaleUrlCTM } from "@/lib/utils/i18nUtils";
import { markdownify } from "@/lib/utils/textConverter";

type Props = {
  tag?: "button" | "a";
  content: {
    enable?: boolean;
    label: string;
    url?: string;
    rel?: string;
    target?: string;
  };
  class?: string;
  [key: string]: any;
};

const {
  tag = "a",
  content: { enable, label, url, rel, target },
  ...rest
} = Astro.props;

const normalizedLabel = (label || "").trim().toLowerCase();
const opensContactModal =
  normalizedLabel === "work with us" || normalizedLabel === "get started";
---

{
  enable &&
    (tag && tag === "button" ? (
      <button
        data-content={label}
        data-open-contact={opensContactModal ? "true" : undefined}
        class:list={["btn", Astro.props.class, "relative overflow-hidden"]}
        {...rest}>
        <span class="label" set:html={markdownify(label)} />
        <slot />
      </button>
    ) : (
      <a
        {...{
          ...(opensContactModal ? { "data-open-contact": "true" } : {}),
          // Set `rel` attribute for external urls or use provided value
          rel: opensContactModal
            ? undefined
            : url?.startsWith("http")
            ? rel || "noopener noreferrer"
            : rel || undefined,

          // Set `target` to "_blank" for external urls unless otherwise specified
          target: opensContactModal
            ? undefined
            : url?.startsWith("http")
            ? target || "_blank"
            : target || undefined,

          // Set `href` attribute
          href: opensContactModal
            ? "#"
            : url && getLocaleUrlCTM(url, Astro.currentLocale),
        }}
        data-content={label}
        class:list={["btn", Astro.props.class, "relative overflow-hidden"]}
        {...rest}>
        <span class="label" set:html={markdownify(label)} />
        <slot />
      </a>
    ))
}
