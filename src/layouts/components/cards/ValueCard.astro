---
import { markdownify } from "@/lib/utils/textConverter";
import Icon from "@/components/icons/Icon.astro";

interface Props {
  title: string;
  description: string;
  icon?: string;
  featured?: boolean;
}

const { title, description, icon, featured = false } = Astro.props;
const iconToken = icon?.includes("/")
  ? icon.split("/").pop()?.replace(".svg", "")
  : icon;
const allowedIcons = [
  "experience",
  "gear",
  "handshake",
  "clock",
  "bolt",
  "cycle",
] as const;
const isAllowedIcon = (
  value: string | undefined,
): value is (typeof allowedIcons)[number] =>
  !!value && (allowedIcons as readonly string[]).includes(value);
const normalizedIcon = isAllowedIcon(iconToken) ? iconToken : undefined;
const firstToken = title?.trim().split(/\s+/)[0] ?? "";
const hasMetricToken = /\d/.test(firstToken);
const displayTitle =
  hasMetricToken && featured ? title.replace(/^\S+\s*/, "") : title;
const cardStyle = featured
  ? "background-image: var(--gradient-about-card-dark); border-color: var(--color-about-card-border-dark);"
  : "background-image: var(--gradient-about-card-light); border-color: var(--color-about-card-border-soft);";
const glowStyle = featured
  ? "background: var(--color-about-card-glow-dark);"
  : "background: var(--color-about-card-glow-light);";
---

<div
  class:list={[
    "value-card relative h-full overflow-hidden rounded-[18px] border p-8 transition-all duration-300",
    "hover:-translate-y-0.5",
    featured ? "text-white" : "text-monire-deep-teal",
  ]}
  style={cardStyle}>
  <div
    class="pointer-events-none absolute -right-14 -bottom-14 h-44 w-44 rounded-full blur-3xl"
    style={glowStyle}
  />
  {
    hasMetricToken && featured && (
      <div class="relative mb-2 text-7xl leading-none font-semibold tracking-tight md:text-8xl">
        {firstToken}
      </div>
    )
  }
  <div class="relative mb-5 flex items-start gap-3">
    {
      normalizedIcon && !(hasMetricToken && featured) && (
        <Icon
          name={normalizedIcon}
          class:list={[
            "h-10 w-10",
            featured ? "text-white" : "text-monire-deep-teal",
          ]}
          title={title}
        />
      )
    }

    {
      title && (
        <h3
          class:list={[
            "leading-snug font-semibold tracking-tight",
            featured ? "text-white" : "text-monire-deep-teal",
          ]}
          style="font-size: var(--text-card-title);"
          set:html={markdownify(displayTitle)}
        />
      )
    }
  </div>
  {
    description && (
      <p
        class:list={[
          "relative text-[1.05rem] leading-relaxed",
          featured ? "text-white/90" : "text-monire-deep-teal/90",
        ]}
        set:html={markdownify(description)}
      />
    )
  }
</div>
