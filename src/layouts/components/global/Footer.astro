---
import social from "@/config/social.json";
import Logo from "@/components/global/Logo.astro";
import config from ".astro/config.generated.json" with { type: "json" };
import { markdownify } from "@/lib/utils/textConverter";
import { splitProtectedText } from "@/lib/utils/splitProtectedText";
import SocialComponent from "@/components/social/Social.astro";
import { useTranslations, getLocaleUrlCTM } from "@/lib/utils/i18nUtils";
import contact from "@/config/contact.json";
import Link from "@/layouts/components/links/Link.astro";

const t = await useTranslations(Astro.currentLocale as string);

let { copyright, footerDescription } = config.settings;

footerDescription = footerDescription || t("footer.description");
const copyrightText = copyright.text || t("footer.copyright");
const copyrightParts = splitProtectedText(copyrightText);
const privacyPolicyLabel = t("footer.privacyPolicy") as string;
const servingClientsLabel = t("footer.servingClientsWorldwide") as string;
const privacyPolicyUrl = getLocaleUrlCTM(
  "/privacy-policy",
  Astro.currentLocale,
);

function encodeEmail(email: string) {
  return email
    .split("")
    .map((char) => `&#${char.charCodeAt(0)};`)
    .join("");
}

const encodedEmail = encodeEmail(contact.email);
---

<footer class="footer-dark-teal">
  <div class="footer-dark-teal-inner">
    <div class="container space-y-14 lg:space-y-20">
      <div
        class="grid gap-12 pt-14 md:pt-16 lg:grid-cols-[minmax(0,1.3fr)_minmax(0,2fr)] lg:items-start lg:gap-14">
        <div class="flex flex-col items-start gap-y-5 text-left lg:pe-8">
          <Logo />
          {
            footerDescription && (
              <p
                class="max-w-[36ch] text-white/90"
                set:html={markdownify(footerDescription)}
              />
            )
          }
          <SocialComponent
            layout="classic"
            linkType="follow"
            class="footer-social mt-1 gap-2"
            size="sm"
            list={social.main.filter((social) => social.enable)}
          />
        </div>
        <div class="grid gap-x-10 gap-y-10 sm:grid-cols-2 lg:grid-cols-2">
          <div>
            {
              t("footer.company") && (
                <h3
                  class="text-h5 text-light mb-6"
                  set:html={t("footer.company")}
                />
              )
            }
            <ul class="footer-quick-links">
              {
                t("footerMenuQuickLink") &&
                  t("footerMenuQuickLink").map(
                    (menu: { name: string; url: string }) => (
                      <li class="inline-block">
                        <Link
                          variant="footer"
                          href={getLocaleUrlCTM(menu.url, Astro.currentLocale)}>
                          {menu.name}
                        </Link>
                      </li>
                    ),
                  )
              }
            </ul>
          </div>
          <div>
            {
              t("footer.contact") && (
                <h3
                  class="text-h5 text-light mb-6"
                  set:html={t("footer.contact")}
                />
              )
            }
            <ul class="flex flex-col gap-2">
              <li class="inline-block">
                <Link
                  variant="footer"
                  href={`mailto:${contact.email}`}
                  htmlLabel={encodedEmail}
                />
              </li>
              <li class="inline-block text-white/82">
                {contact.location}
              </li>
              {
                servingClientsLabel && (
                  <li class="inline-block text-white/72">
                    {servingClientsLabel}
                  </li>
                )
              }
            </ul>
          </div>
        </div>
      </div>

      <div class="border-t border-white/12 py-7 text-sm md:text-base">
        <div class="flex flex-wrap items-center justify-center gap-x-8 gap-y-4">
          {
            config.settings.copyright && config.settings.copyright.enable && (
              <ul class="footer-bottom-links flex flex-wrap items-center justify-center gap-y-4 text-white">
                {copyrightParts.map((value: string) => (
                  <li class="inline-block opacity-90">{value}</li>
                ))}
              </ul>
            )
          }
        </div>
      </div>
    </div>
  </div>
</footer>

<style>
  .footer-dark-teal {
    background: var(--gradient-dark-teal);
  }

  .footer-dark-teal-inner {
    background:
      radial-gradient(
        55% 55% at 50% 115%,
        var(--color-dark-teal-orb-soft-soft) 0%,
        transparent 75%
      ),
      radial-gradient(
        42% 42% at 50% -10%,
        var(--color-dark-teal-orb-strong-soft) 0%,
        transparent 85%
      );
  }

  .footer-social :global(a) {
    color: var(--color-link-dark-bg);
    background: transparent;
    border: 1px solid
      color-mix(in srgb, var(--color-link-dark-bg) 55%, transparent);
  }

  .footer-social :global(a:hover) {
    color: var(--color-link-dark-bg-hover);
    background: transparent;
    border-color: color-mix(
      in srgb,
      var(--color-link-dark-bg-hover) 72%,
      transparent
    );
  }

  .footer-social :global(a:focus-visible) {
    outline: 2px solid var(--color-link-dark-bg-focus);
    outline-offset: 2px;
  }

  .footer-dark-teal :global(.logo-wrapper) {
    margin-left: 0 !important;
    padding-left: 0 !important;
  }

  .footer-dark-teal :global(.logo-wrapper .logo) {
    margin-left: 0 !important;
    transform: translateX(-1.9rem);
    max-width: calc(100% + 1.9rem);
  }

  .footer-quick-links {
    display: grid;
    grid-template-columns: 1fr;
    row-gap: 0.5rem;
  }

  @media (min-width: 420px) {
    .footer-quick-links {
      display: inline-grid;
      grid-auto-flow: column;
      grid-template-rows: repeat(4, auto);
      grid-template-columns: repeat(2, auto);
      justify-content: start;
      column-gap: 2rem;
      row-gap: 0.5rem;
    }
  }

  .footer-bottom-links > li {
    display: inline-flex;
    align-items: center;
  }

  .footer-bottom-links > li + li::before {
    content: "/";
    display: inline-block;
    margin: 0 0.75rem;
    color: var(--color-light);
    line-height: 1;
    transform: translateY(-0.01em);
  }
</style>
