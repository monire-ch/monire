---
import type { NavigationLink } from "@/types";
import NavDropdownMenu from "@/layouts/components/global/header/DropdownMenu.astro";

const menu = Astro.props.menu as NavigationLink;
const { pathname } = Astro.url;
---

{
  (menu.hasChildren || menu.hasMegaMenu) && menu.name ? (
    <NavDropdownMenu menu={menu} />
  ) : (
    menu.name && (
      <li class="nav-item" role="menuitem">
        <a
          href={menu.url || "/"}
          on:click={(e: MouseEvent) => {
            if (window.location.pathname !== "/") {
              window.location.href = "/";
            }
          }}
          class:list={[
            "nav-link",
            { "nav-link-active": pathname === menu.url },
          ]}>
          {menu.name}
        </a>
      </li>
    )
  )
}
<script>
  if (typeof window !== "undefined") {
    const updateActiveLinks = () => {
      const { pathname, hash } = window.location;
      const links = document.querySelectorAll(".nav-link");

      links.forEach((link) => {
        const a = link as HTMLAnchorElement;
        const linkPath = a.pathname;
        const linkHash = a.hash;

        // CASE 1 — Home "/" should ONLY be active on exact "/"
        if (linkPath === "/" && !linkHash) {
          if (pathname === "/" && !hash) {
            link.classList.add("nav-link-active");
          } else {
            link.classList.remove("nav-link-active");
          }
          return;
        }

        // CASE 2 — Hash-based links (/#services, /#pricing, etc)
        if (linkHash) {
          if (pathname === "/" && hash === linkHash) {
            link.classList.add("nav-link-active");
          } else {
            link.classList.remove("nav-link-active");
          }
          return;
        }
      });
    };

    window.addEventListener("load", updateActiveLinks);
    window.addEventListener("hashchange", updateActiveLinks);
  }
</script>
