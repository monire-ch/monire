---
import Subtitle from "@/layouts/components/widgets/Subtitle.astro";
import type { Button, Section } from "@/types";
import { getEntryCTM } from "@/lib/contentParser.astro";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import { markdownify } from "@/lib/utils/textConverter";
import ButtonLink from "../buttons/ButtonLink.astro";

type aboutSectionType = Section & {
  layoutType?: "modern" | "creative";
  list: {
    title: string;
    titleSize: string;
    image?: string;
    descriptionFontSize?: "sm" | "lg";
    description: string;
    ctaBtn: Button;
    ctaBtn2?: Button;
  }[];
};
type Props = {
  content?: aboutSectionType;
};

let defaultContent = (
  await getEntryCTM("sections", "about", Astro.currentLocale)
)?.data as aboutSectionType;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as aboutSectionType;

let {
  enable = true,
  title,
  subtitle,
  list,
} = actualContent as aboutSectionType;
---

{
  enable && (
    <section class="relative pt-28 pb-16 md:pt-36 md:pb-20" id="about">
      <div class="container space-y-12 md:space-y-16">
        <div
          class="mx-auto shrink-0 text-center lg:max-w-2xl"
          data-aos="fade-up-sm">
          <Subtitle content={subtitle} />
          {title && (
            <h2
              class="section-title has-italic-text text-white capitalize"
              set:html={markdownify(title)}
            />
          )}
        </div>
        <div data-aos="fade-up-sm" data-aos-delay="200">
          {list.map((item, index) => (
            <article
              class:list={[
                "grid gap-8 py-9 md:py-11 lg:grid-cols-[minmax(0,0.9fr)_minmax(0,1.7fr)] lg:gap-14",
                "border-b border-white/12",
              ]}>
              <div class="space-y-4">
                <p class="text-xs font-medium tracking-[0.2em] text-white/74 uppercase">
                  {`CHAPTER ${String(index + 1).padStart(2, "0")}`}
                </p>
                {item.title && (
                  <h3
                    class="text-4xl leading-[1.04] font-semibold tracking-tight text-white md:text-5xl"
                    set:html={markdownify(item.title)}
                  />
                )}
              </div>

              <div class="space-y-6">
                {item.description && (
                  <div
                    class="prose prose-p:leading-relaxed max-w-none md:max-w-[56ch] prose-p:text-white/90"
                    set:html={markdownify(item.description, true)}
                  />
                )}
                {(item.ctaBtn?.enable || item.ctaBtn2?.enable) && (
                  <div class="flex flex-wrap items-center gap-4 pt-2">
                    {item.ctaBtn?.enable && (
                      <ButtonLink
                        class="text-center"
                        variant="secondary"
                        content={{ ...item.ctaBtn }}
                      />
                    )}
                    {item.ctaBtn2?.enable && (
                      <ButtonLink
                        class="text-center"
                        variant="secondary"
                        content={{ ...item.ctaBtn2 }}
                      />
                    )}
                  </div>
                )}
              </div>
            </article>
          ))}
        </div>
      </div>
    </section>
  )
}
