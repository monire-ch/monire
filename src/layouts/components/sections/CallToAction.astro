---
import type { Section } from "@/types";
import { getEntryCTM } from "@/lib/contentParser.astro";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import { markdownify } from "@/lib/utils/textConverter";
import ButtonLink from "@/layouts/components/buttons/ButtonLink.astro";
import SectionWave from "@/assets/images/svgs/section-wave-mask.svg";

type ctaSectionType = Section;

type Props = {
  content?: ctaSectionType;
};

let defaultContent = (
  await getEntryCTM("sections", "call-to-action", Astro.currentLocale)
)?.data as ctaSectionType;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as ctaSectionType;

let { enable = true, title, ctaBtn } = actualContent as ctaSectionType;
---

{
  enable && (
    <section class="cta-section section-light cta-wave-light has-wave-padding relative mt-auto">
      <SectionWave
        class="cta-wave-top"
        aria-hidden="true"
        preserveAspectRatio="none"
      />
      <div class="py-14 md:py-28">
        <div class="container grid grid-cols-1 place-content-between gap-y-16 lg:grid-cols-2 lg:gap-x-10">
          <div
            class="space-y-7 lg:max-w-2xl"
            data-aos="fade-up-sm"
            data-aos-offset="0">
            {title && (
              <h2
                class="section-title has-italic-text text-monire-deep-teal capitalize"
                set:html={markdownify(title)}
              />
            )}
          </div>
          <div class="flex flex-wrap-reverse items-center gap-x-20 gap-y-6 md:flex-nowrap lg:justify-end">
            {ctaBtn && ctaBtn.enable && (
              <div class="relative" data-aos="fade-right-sm">
                <ButtonLink
                  class="btn-md btn-pricing-light group relative z-30 flex items-center gap-4"
                  content={ctaBtn}
                />
              </div>
            )}
          </div>
        </div>
      </div>
    </section>
  )
}

<style>
  .cta-wave-light {
    isolation: isolate;
  }

  .cta-wave-top {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    width: 100%;
    min-width: 0;
    height: clamp(3.25rem, 7vw, 6.875rem);
    transform: translateY(-99%);
    color: var(--color-bg-page);
    fill: currentColor;
    pointer-events: none;
    z-index: 1;
  }

  .cta-wave-light > div {
    position: relative;
    z-index: 2;
  }
</style>
