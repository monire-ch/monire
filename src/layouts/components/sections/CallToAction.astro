---
import type { Section } from "@/types";
import { getEntryCTM } from "@/lib/contentParser.astro";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import { markdownify } from "@/lib/utils/textConverter";
import Button from "@/layouts/components/buttons/Button.astro";
import Subtitle from "@/layouts/components/widgets/Subtitle.astro";
import SectionWave from "@/assets/images/svgs/section-wave-mask.svg";

type ctaSectionType = Section;

type Props = {
  content?: ctaSectionType;
};

let defaultContent = (
  await getEntryCTM("sections", "call-to-action", Astro.currentLocale)
)?.data as ctaSectionType;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as ctaSectionType;

let {
  enable = true,
  title,
  subtitle,
  ctaBtn,
} = actualContent as ctaSectionType;
---

{
  enable && (
    <section class="cta-section section-light cta-wave-light has-wave-padding relative mt-auto">
      <SectionWave
        class="cta-wave-top"
        aria-hidden="true"
        preserveAspectRatio="none"
      />
      <div class="container py-6 md:py-6">
        <div
          class="mx-auto flex max-w-2xl flex-col items-center space-y-8 text-center"
          data-aos="fade-up-sm"
          data-aos-offset="0">
          {subtitle && (
            <Subtitle content={subtitle} class="mb-0" />
          )}
          {title && (
            <h2
              class="section-title has-italic-text text-monire-deep-teal capitalize"
              set:html={markdownify(title)}
            />
          )}
          {ctaBtn && ctaBtn.enable && (
            <Button content={ctaBtn} variant="primary" class="mt-2 md:mt-3" />
          )}
        </div>
      </div>
    </section>
  )
}

<style>
  .cta-wave-light {
    isolation: isolate;
  }

  .cta-wave-top {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    width: 100%;
    min-width: 0;
    height: clamp(3.25rem, 7vw, 6.875rem);
    transform: translateY(-99%);
    color: var(--color-bg-page);
    fill: currentColor;
    pointer-events: none;
    z-index: 1;
  }

  .cta-wave-light > div {
    position: relative;
    z-index: 2;
  }
</style>
