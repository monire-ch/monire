---
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import { markdownify } from "@/lib/utils/textConverter";
import type { Button as ButtonData, Section } from "@/types";
import { getEntryCTM } from "@/lib/contentParser.astro";
import Button from "../buttons/Button.astro";
import AnimatedText from "../widgets/AnimatedText.astro";
import HeroBlobs from "@/components/hero/HeroBlobs.astro";

type homeBannerSectionType = Section & {
  button: ButtonData;
  ctaContext?: string;
};

type Props = {
  content?: homeBannerSectionType;
};

let defaultContent = (
  await getEntryCTM("sections", "home-banner", Astro.currentLocale)
)?.data as homeBannerSectionType;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as homeBannerSectionType;

let { title, subtitle, description, button, ctaContext } =
  actualContent as homeBannerSectionType;
---

<section class="hero-bg">
  <HeroBlobs />
  <div class="container">
    <div class="relative z-10 mx-auto max-w-4xl">
      <div>
        {
          title && (
            <AnimatedText
              class="font-hero gold-text hero-title mb-6 text-center tracking-wider capitalize"
              content={markdownify(title)}
            />
          )
        }
        {
          subtitle && (
            <AnimatedText
              class="hero-subtitle text-center"
              stagger={0.03}
              delay={0.3}
              content={markdownify(subtitle)}
            />
          )
        }
        {
          description && (
            <p
              class="hero-description shrink-0 text-center tracking-wider opacity-90"
              data-aos="fade-in"
              data-aos-delay="300"
              data-aos-duration="900"
              set:html={markdownify(description)}
            />
          )
        }
      </div>
      <div
        data-aos="fade-in"
        data-aos-delay="400"
        data-aos-duration="900"
        class="hero-cta-stack flex flex-col items-center justify-center">
        {
          ctaContext && (
            <p
              class="hero-cta-context text-center"
              set:html={markdownify(ctaContext)}
            />
          )
        }
        {
          button && (
            <Button
              content={button}
              variant="primary"
              iconLoading="eager"
              iconFetchpriority="high"
            />
          )
        }
      </div>
    </div>
  </div>
</section>

<style is:global>
  .hero-bg {
    --hero-header-offset: clamp(68px, 7.5vw, 92px);
    position: relative;
    background-color: var(--color-primary);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    z-index: 0;
    margin-top: calc(-1 * var(--hero-header-offset));
    padding-top: var(--hero-header-offset);
    min-height: calc(100svh + var(--hero-header-offset));
    display: flex;
    align-items: center;
    overflow: hidden;
  }

  main.has-section-spacing-lg > section.hero-bg,
  main.has-section-spacing-md > section.hero-bg {
    padding-top: var(--hero-header-offset);
    padding-bottom: 0;
  }

  .container {
    position: relative;
    z-index: 10;
  }

  .gold-text,
  .gold-text * {
    @apply bg-clip-text text-transparent;
    background-image:
      var(--image-texture-gold),
      var(--gradient-gold-cool);
    background-size:
      cover,
      100% 100%;
    background-position:
      center,
      center;
    background-repeat:
      no-repeat,
      no-repeat;

    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;

    color: var(--color-link-dark-bg);
  }

  .hero-title {
    font-size: clamp(2rem, 4.6vw, 4.2rem);
    line-height: 1.06;
    letter-spacing: 0.01em;
  }

  .hero-subtitle {
    font-size: clamp(1.05rem, 1.7vw, 1.35rem);
    line-height: 1.45;
    color: var(--color-text-shell-muted);
  }

  .hero-description {
    font-size: clamp(1rem, 1.35vw, 1.35rem);
    line-height: 1.5;
    margin-bottom: 0;
    color: var(--color-text-shell-muted);
  }

  .hero-cta-stack {
    margin-top: clamp(1.5rem, 2.4vw, 2.2rem);
    gap: clamp(1.5rem, 2.4vw, 2.2rem);
  }

  .hero-cta-context {
    font-size: clamp(0.85rem, 1vw, 0.95rem);
    line-height: 1.45;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: color-mix(in srgb, var(--color-text-shell-muted) 94%, white);
  }

  @media (max-width: 1023px) {
    .hero-bg {
      --hero-header-offset: 64px;
      min-height: calc(100svh + var(--hero-header-offset));
    }

    .hero-description {
      max-width: 34ch;
      margin-inline: auto;
    }
  }

  @media (max-width: 767px) {
    .hero-bg {
      --hero-header-offset: 56px;
      min-height: calc(100svh + var(--hero-header-offset));
    }

    .hero-subtitle {
      max-width: 31ch;
      margin-inline: auto;
    }

    .hero-description {
      max-width: 31ch;
      margin-inline: auto;
    }
  }
</style>
