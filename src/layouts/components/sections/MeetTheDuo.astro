---
import { markdownify } from "@/lib/utils/textConverter";
import { getEntryCTM } from "@/lib/contentParser.astro";
import type { Section } from "@/types";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import SocialMediaLink from "@/layouts/components/social/SocialMediaLink.astro";
import OptimizedImage from "@/components/utilities/OptimizedImage.astro";
import Subtitle from "@/layouts/components/widgets/Subtitle.astro";

type meetTheDuoSectionType = Section & {
  items: {
    name: string;
    title: string;
    image: string;
    role: string;
    languages: string;
    linkedin: string;
  }[];
};

type Props = {
  content?: meetTheDuoSectionType;
};

let defaultContent = (
  await getEntryCTM("sections", "meet-the-duo", Astro.currentLocale)
)?.data as meetTheDuoSectionType;

let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as meetTheDuoSectionType;

let { title, description, items } = actualContent as meetTheDuoSectionType;
---

<section class="relative pt-8 pb-20 md:pt-10 md:pb-28">
  <div class="container mx-auto space-y-8 md:space-y-10">
    <div class="text-left" data-aos="fade-up-sm">
      {
        title && (
          <Subtitle content={title} class="mx-0!" />
        )
      }
      {
        description && (
          <h3
            class="section-title has-italic-text max-w-3xl text-white/95"
            set:html={markdownify(description)}
          />
        )
      }
    </div>

    <div class="grid gap-x-6 gap-y-10 lg:grid-cols-2 lg:gap-y-6">
      {
        items.map((item, index) => (
          <article
            class="mx-auto flex max-w-[300px] flex-col items-center text-center md:max-w-none md:grid md:grid-cols-[300px_1fr] md:items-center md:gap-6 md:text-left"
            data-aos="fade-up-sm"
            data-aos-delay={String(200 + index * 100)}>
            <div
              class="relative w-full max-w-[300px] overflow-hidden rounded-3xl border"
              style="border-color: var(--color-border-overlay); background: var(--color-surface-overlay);">
              <OptimizedImage
                src={item.image}
                width={600}
                height={750}
                widths={[220, 260, 300, 360, 420]}
                sizes="(min-width: 768px) 300px, min(300px, calc(100vw - 2rem))"
                alt={item.name}
                class="aspect-[4/5] w-full object-cover object-center"
              />
              <div class="meet-duo-link absolute right-3 bottom-3">
                <SocialMediaLink
                  size="sm"
                  layout="classic"
                  label={`${item.name}'s Linkedin'`}
                  url={item.linkedin}
                  icon="/images/icons/svg/linkedin.svg"
                />
              </div>
            </div>

            <div class="space-y-2 pt-4 md:pt-0">
              <h3 class="text-[2.15rem] leading-tight font-semibold text-white">
                {item.name}
              </h3>
              <p class="text-base text-white/90">{item.role}</p>
              <p class="text-sm text-white/78">{item.languages}</p>
            </div>
          </article>
        ))
      }
    </div>
  </div>
</section>

<style>
  .meet-duo-link :global(a) {
    color: var(--color-link-dark-bg);
    width: 2.45rem;
    height: 2.45rem;
    background: var(--color-duo-link-bg);
    border: 1px solid var(--color-duo-link-border);
    box-shadow: var(--shadow-duo-link);
    backdrop-filter: blur(3px);
  }

  .meet-duo-link :global(a:hover) {
    background: var(--color-duo-link-bg-hover);
    border-color: var(--color-duo-link-border-hover);
  }

  .meet-duo-link :global(svg[data-icon="true"] rect) {
    fill: transparent;
  }

  .meet-duo-link :global(svg[data-icon="true"]) {
    width: 1rem;
    height: 1rem;
  }

  .meet-duo-link :global(svg[data-icon="true"] path) {
    fill: currentColor;
  }
</style>
