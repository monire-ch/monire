---
import { markdownify } from "@/lib/utils/textConverter";
import overrideObjects from "@/lib/utils/overrideObjects";
import ButtonLink from "@/layouts/components/buttons/ButtonLink.astro";
import PricingCard from "@/layouts/components/cards/PricingCard.astro";
import Subtitle from "@/layouts/components/widgets/Subtitle.astro";
import { getEntryCTM } from "@/lib/contentParser.astro";

const defaultContent = (
  await getEntryCTM("sections", "pricing-section", Astro.currentLocale)
)?.data;

const content = overrideObjects(defaultContent, Astro.props.content);

const { title, subtitle, plans, list, heading, description, ai_automations } =
  content;
---

<section id="pricing" class="relative">
  <!-- background glows -->
  <div aria-hidden class="pointer-events-none absolute inset-0">
    <div
      class="absolute -top-40 left-1/2 h-[600px] w-[800px] -translate-x-1/2 rounded-full bg-emerald-500/20 blur-[120px]">
    </div>

    <div
      class="absolute right-[-200px] bottom-0 h-[500px] w-[500px] rounded-full bg-teal-400/20 blur-[120px]">
    </div>
  </div>

  <div class="container space-y-12 md:space-y-16">
    <!-- Title & Subtitle -->
    <div class="mx-auto max-w-2xl space-y-5 text-center">
      {subtitle && <Subtitle content={subtitle} />}
      {
        title && (
          <h2
            class="has-italic-text capitalize"
            set:html={markdownify(title)}
          />
        )
      }
    </div>

    <!-- Tab Buttons -->
    <div class="flex justify-center gap-4">
      {
        plans?.list?.map((item) => (
          <button
            class="pricing-tab rounded-lg border border-white/20 px-6 py-2 text-sm font-medium tracking-wide transition data-[active=true]:border-white data-[active=true]:bg-white data-[active=true]:text-black data-[active=true]:shadow-lg"
            data-tab={item.label}
            data-active={item.selected ? "true" : "false"}>
            {item.label}
          </button>
        ))
      }
    </div>

    <!-- WEB DESIGN CONTENT -->
    <div
      id="web-design-content"
      class:list={[plans.list[0].selected ? "block" : "hidden"]}>
      <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
        {
          list?.map((item, index) => (
            <PricingCard index={index} content={{ ...item, plans }} />
          ))
        }
      </div>

      {
        heading && (
          <h4
            class="mt-10 text-center font-medium"
            set:html={markdownify(heading)}
          />
        )
      }

      {
        description && (
          <p
            class="mx-auto max-w-2xl text-center"
            set:html={markdownify(description, true)}
          />
        )
      }
    </div>

    <!-- AI AUTOMATIONS CONTENT -->
    <div
      id="ai-content"
      class:list={[plans.list[1].selected ? "block" : "hidden"]}
      class="space-y-6 text-center">
      <h3 class="text-h3 font-semibold">
        {ai_automations.title}
      </h3>

      <p class="mx-auto max-w-xl text-base opacity-80">
        {ai_automations.subtitle}
      </p>

      <div class="mt-6 flex items-center justify-center gap-4">
        {
          ai_automations.ctas.map((btn) => (
            <ButtonLink
              content={{
                enable: true,
                label: btn.label,
                url: btn.url,
              }}
              class="btn-md btn-primary flex justify-center text-center"
            />
          ))
        }
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tabs = document.querySelectorAll(".pricing-tab");
    const webDesign = document.getElementById("web-design-content");
    const aiBlock = document.getElementById("ai-content");

    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        tabs.forEach((t) => (t.dataset.active = "false"));
        tab.dataset.active = "true";
        if (tab.dataset.tab === "WEB DESIGN & DEVELOPMENT") {
          webDesign.classList.remove("hidden");
          aiBlock.classList.add("hidden");
        } else {
          aiBlock.classList.remove("hidden"); // ‚Üê missing
          webDesign.classList.add("hidden");
        }
      });
    });
  });
</script>
