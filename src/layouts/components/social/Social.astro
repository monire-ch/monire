---
import { getLocaleUrlCTM } from "@/lib/utils/i18nUtils";
import { slugifyyy } from "@/lib/utils/textConverter";
import type { SocialLink } from "@/types";
import SocialMediaLink from "./SocialMediaLink.astro";

const baseURL = import.meta.env.SITE;

interface BaseProps {
  class?: string;
  size?: "sm" | "md" | "lg";
  list: SocialLink[];
  linkType?: "share" | "follow"; // Remove the optional type; it's always defined in Props.
  layout: "classic" | "minimal" | "modern";
  [key: string]: any;
}

interface ShareProps extends BaseProps {
  slug: string;
  linkType?: "share";
  title?: string;
  description?: string;
  disabled?: string[];
}

interface FollowProps extends BaseProps {
  linkType?: "follow";
}

type Props = ShareProps | FollowProps;

let {
  list,
  size = "md",
  title,
  slug,
  disabled,
  layout = "modern",
  linkType = "follow",
  description,
  class: className,
  ...rest
} = Astro.props as Props; // Ensure Astro.props is typed as Props

slug = slug ? getLocaleUrlCTM(slug, Astro.currentLocale) : "";
list = linkType === "share" ? list : list.filter((social) => social.url);

const shareLinks: { [key: string]: string } = {
  facebook: `https://www.facebook.com/sharer/sharer.php?u=${slug}`,
  twitter: `https://twitter.com/intent/tweet/?text=${title || ""}&amp;url=${slug}`,
  linkedin: `https://www.linkedin.com/shareArticle?mini=true&url=${slug}&title=${title || ""}&summary=${slugifyyy(description) || ""}&source=${baseURL}`,
  pinterest: `https://pinterest.com/pin/create/button/?url=${slug}&media=&description=${slugifyyy(description) || ""}`,
};

if (disabled) {
  list = list.filter((social) => !disabled.includes(social.label));
}
---

{
  list && list[0] && (
    <ul class:list={["flex flex-wrap items-center gap-4", className]} {...rest}>
      {list.map((social) => (
        <li>
          <SocialMediaLink
            label={social.label}
            url={linkType === "share" ? shareLinks[social.label] : social.url}
            icon={social.icon}
            layout={layout}
            size={size}
          />
        </li>
      ))}
    </ul>
  )
}
