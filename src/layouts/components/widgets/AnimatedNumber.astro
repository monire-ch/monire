---
import { markdownify } from "@/lib/utils/textConverter";
import "@/plugins/odometer/odometer.min.css";

interface Props {
  class?: string;
  animateOn?: "click";
  transitionTime?: string;
  childClass?: string;
  enable?: boolean;
  content: {
    value?: number;
    type?: string;
    prependValue?: string;
    appendValue?: string;
  };
}

const {
  enable = true,
  animateOn,
  transitionTime,
  class: className,
  childClass: childClassName,
  content,
} = Astro.props;

// Swiss formatter
const formatCH = (value: number) =>
  new Intl.NumberFormat("de-CH", {
    maximumFractionDigits: 0,
  }).format(value);

// Zero placeholder for animation
const addZero = (value: number) => "0".repeat(String(value).length);

const formattedValue =
  typeof content.value === "number" ? formatCH(content.value) : undefined;
---

<div
  class:list={[
    "font-secondary inline-flex place-items-stretch leading-none",
    { "has-animated-number": enable },
    className,
  ]}>
  {
    content.prependValue && (
      <span
        class:list={["prepend", childClassName]}
        set:html={markdownify(content.prependValue)}
      />
    )
  }

  <span
    {...{
      "data-count": formattedValue,
      "data-type": content.type?.toLowerCase(),
      "data-format": "(ddd)", // no grouping, we already formatted
      style: { "--odometer-duration": transitionTime },
    }}
    class:list={[{ odometer: enable }, childClassName]}
    set:html={enable && content.value && animateOn !== "click"
      ? addZero(content.value)
      : formattedValue}
  />

  {
    content.appendValue && (
      <span
        class:list={["append", childClassName]}
        set:html={markdownify(content.appendValue)}
      />
    )
  }
</div>

<script type="module">
  await import("@/plugins/odometer/odometer.min.js");
</script>
