---
interface Props {
  class?: string;
  content: string;
  duration?: number;
  delay?: number;
  stagger?: number;
}

let {
  content,
  duration = 0.6,
  delay = 0,
  stagger = 0.1,
  ...rest
} = Astro.props;

let processedContent = "";
if (content) {
  const words = content.split(" "); // Split text into words
  processedContent = words
    .map(
      (word: string, index: number) =>
        `<span class="word" style="--word-index:${index};">${word}</span>`,
    )
    .join(" ");
}
---

<div
  class:list={["animated-text", Astro.props.class]}
  set:html={processedContent}
  style={`--at-duration:${duration}s; --at-delay:${delay}s; --at-stagger:${stagger}s;`}
  {...rest}
/>

<style is:global>
  .animated-text .word {
    display: inline-block;
    opacity: 0;
    transform: translateY(10px);
    filter: blur(8px);
    will-change: transform, opacity, filter;
    animation-name: animated-text-word-in;
    animation-duration: var(--at-duration, 0.6s);
    animation-delay: calc(
      var(--at-delay, 0s) + (var(--word-index, 0) * var(--at-stagger, 0.1s))
    );
    animation-timing-function: cubic-bezier(0.22, 1, 0.36, 1);
    animation-fill-mode: forwards;
  }

  @keyframes animated-text-word-in {
    to {
      opacity: 1;
      transform: none;
      filter: none;
      will-change: auto;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .animated-text .word {
      animation: none;
      opacity: 1;
      transform: none;
      filter: none;
      will-change: auto;
    }
  }
</style>
