---
import Base from "@/layouts/Base.astro";
import CallToAction from "@/layouts/components/sections/CallToAction.astro";
import DarkTealPageTheme from "@/layouts/components/themes/DarkTealPageTheme.astro";
import { getEntryCTM } from "@/lib/contentParser.astro";
import { generatePaths } from "@/lib/utils/i18nUtils";
import { markdownify } from "@/lib/utils/textConverter";

export function getStaticPaths() {
  return generatePaths();
}

type ApplyPageContent = {
  enable?: boolean;
  title?: string;
  metaTitle?: string;
  metaDescription?: string;
  subtitle?: string;
  heading?: string;
  description?: string;
  supportingText?: string;
  stepsTitle?: string;
  steps?: Array<{ title: string; description: string }>;
};

const applyContent = (
  await getEntryCTM("sections", "apply-page", Astro.currentLocale)
)?.data as ApplyPageContent;
---

<Base {...applyContent}>
  <DarkTealPageTheme
    title={applyContent?.heading}
    subtitle={applyContent?.subtitle}>
    <div class="apply-page relative overflow-hidden">
      <div class="container">
        <div class="mx-auto max-w-4xl">
          <div class="apply-content space-y-6 md:space-y-8">
            {applyContent?.description && (
              <p
                class="mx-auto max-w-3xl text-center text-lg leading-relaxed text-[var(--color-text-shell-strong)] md:text-xl"
                set:html={markdownify(applyContent.description)}
              />
            )}
            {applyContent?.supportingText && (
              <p
                class="mx-auto max-w-3xl text-center leading-relaxed text-[var(--color-text-shell-muted)]"
                set:html={markdownify(applyContent.supportingText)}
              />
            )}
            <div class="apply-divider" aria-hidden="true"></div>

            {applyContent?.steps?.length ? (
              <div class="apply-steps space-y-6 md:space-y-7">
                {applyContent?.stepsTitle && (
                  <h2
                    class="text-center text-2xl font-medium tracking-[0.02em] text-[var(--color-text-shell-strong)]"
                    set:html={markdownify(applyContent.stepsTitle)}
                  />
                )}
                <div class="grid gap-5 md:grid-cols-3 md:gap-6">
                  {applyContent.steps.map((step, index) => (
                    <article
                      class:list={[
                        "apply-step rounded-2xl border p-6",
                        index === 1 ? "apply-step-featured" : "apply-step-soft",
                      ]}>
                      <p
                        class:list={[
                          "apply-step-index mb-3 inline-flex rounded-full border px-3 py-1 text-xs font-medium tracking-[0.16em] uppercase",
                        ]}>
                        {`STEP ${index + 1}`}
                      </p>
                      <h3
                        class:list={[
                          "apply-step-title text-lg font-medium",
                        ]}
                        set:html={markdownify(step.title)}
                      />
                      <p
                        class:list={[
                          "apply-step-copy mt-3 leading-relaxed",
                        ]}
                        set:html={markdownify(step.description)}
                      />
                    </article>
                  ))}
                </div>
              </div>
            ) : null}
          </div>
        </div>
      </div>
    </div>
  </DarkTealPageTheme>
  <CallToAction />
</Base>

<style>
  .apply-page {
    --apply-text-strong: var(--color-text-shell-strong);
    --apply-text-muted: var(--color-text-shell-muted);
    --apply-soft-text-strong: var(--color-monire-deep-teal);
    --apply-soft-text-muted: color-mix(in srgb, var(--color-monire-deep-teal) 86%, transparent);
    --apply-step-soft-shadow: 0 10px 20px color-mix(in srgb, var(--color-bg-dark) 14%, transparent);
    padding-top: clamp(1.25rem, 2.2vw, 2rem);
    padding-bottom: clamp(7.5rem, 9vw, 10.5rem);
  }

  .apply-content {
    padding-inline: clamp(0rem, 1vw, 0.5rem);
  }

  .apply-steps {
    padding-top: clamp(0.6rem, 1.2vw, 1rem);
  }

  .apply-divider {
    height: 1px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      color-mix(in srgb, var(--color-border-shell-dark) 92%, transparent) 50%,
      transparent 100%
    );
  }

  .apply-step {
    transition:
      transform 180ms ease,
      border-color 180ms ease;
  }

  .apply-step:hover {
    transform: translateY(-2px);
    border-color: var(--color-mustard-50);
  }

  .apply-step-featured {
    border-color: var(--color-border-surface-dark);
    background: var(--gradient-surface-dark);
  }

  .apply-step-soft {
    border-color: var(--color-border-surface-soft);
    background: var(--gradient-surface-soft);
    box-shadow: var(--apply-step-soft-shadow);
  }

  .apply-step-index {
    background: color-mix(in srgb, var(--color-bg-page) 90%, transparent);
  }

  .apply-step-featured .apply-step-index {
    color: var(--apply-text-strong);
    border-color: color-mix(in srgb, var(--color-mustard-50) 66%, transparent);
    background: color-mix(in srgb, var(--color-bg-dark) 76%, transparent);
  }

  .apply-step-soft .apply-step-index {
    color: var(--apply-soft-text-strong);
    border-color: color-mix(in srgb, var(--color-monire-deep-teal) 34%, transparent);
    background: color-mix(in srgb, var(--color-bg-page) 96%, white);
  }

  .apply-step-featured .apply-step-title {
    color: var(--apply-text-strong);
  }

  .apply-step-soft .apply-step-title {
    color: var(--apply-soft-text-strong);
  }

  .apply-step-featured .apply-step-copy {
    color: var(--apply-text-muted);
  }

  .apply-step-soft .apply-step-copy {
    color: var(--apply-soft-text-muted);
  }
</style>
